openapi: 3.0.0
info:
  title: Animal API with Nested Discriminators
  version: 1.0.0
  description: API demonstrating oneOf with nested discriminators

paths:
  /animals:
    get:
      operationId: listAnimals
      summary: Get all animals
      description: Returns an array of animals with nested polymorphism
      responses:
        "200":
          description: List of animals
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Animal"

components:
  schemas:
    Animal:
      oneOf:
        - $ref: "#/components/schemas/CatPolymorphic"
        - $ref: "#/components/schemas/BirdPolymorphic"
    Cat:
      type: object
      required:
        - animalType
      properties:
        animalType:
          type: string
        furColor:
          type: string

    CatOneOf:
      allOf:
        - $ref: "#/components/schemas/Cat"
        - type: object
          properties:
            animalType:
              const: Cat

    CatPolymorphic:
      oneOf:
        - $ref: "#/components/schemas/CatOneOf"
        - $ref: "#/components/schemas/Lion"
        - $ref: "#/components/schemas/Panthera"
      discriminator:
        propertyName: animalType
        mapping:
          Cat: "#/components/schemas/CatOneOf"
          Lion: "#/components/schemas/Lion"
          Panthera: "#/components/schemas/Panthera"

    Lion:
      allOf:
        - $ref: "#/components/schemas/Cat"
        - type: object
          required:
            - maneSize
          properties:
            maneSize:
              type: string
              enum:
                - small
                - medium
                - large
        - type: object
          properties:
            animalType:
              const: Lion

    Panthera:
      allOf:
        - $ref: "#/components/schemas/Cat"
        - type: object
          required:
            - spotPattern
          properties:
            spotPattern:
              type: string
        - type: object
          properties:
            animalType:
              const: Panthera

    Bird:
      type: object
      required:
        - animalType
      properties:
        animalType:
          type: string
        wingSpan:
          type: number

    BirdPolymorphic:
      oneOf:
        - $ref: "#/components/schemas/Sparrow"
        - $ref: "#/components/schemas/Eagle"
      discriminator:
        propertyName: animalType
        mapping:
          Sparrow: "#/components/schemas/Sparrow"
          Eagle: "#/components/schemas/Eagle"

    Sparrow:
      allOf:
        - $ref: "#/components/schemas/Bird"
        - type: object
          required:
            - chirpFrequency
          properties:
            chirpFrequency:
              type: integer
        - type: object
          properties:
            animalType:
              const: Sparrow

    Eagle:
      allOf:
        - $ref: "#/components/schemas/Bird"
        - type: object
          required:
            - huntingRange
          properties:
            huntingRange:
              type: number
        - type: object
          properties:
            animalType:
              const: Eagle
